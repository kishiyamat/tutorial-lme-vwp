---
layout: post
title: 一般化線形モデル
description: LMEの解説ページ
    <a href="./">  🏠  <a>
---

[前回][u1] はチュートリアルのモチベーションとゴール、
そして線形モデルをつくりました。
またRでモデルを作るには3つの要素が必要だとも述べました。
今回は前回で述べたゴール、
「直線以外の関係 に一般化させる」
について取り組んでいきます。
もう一度モチベーションを振り返りましょう。

まず前回の $y = ax_1 + b$ は `lm` でモデルを作成できますが、
これは $y$ が要因に対して直線の関係にあることや負の値を取れることを仮定してました。
なので $y$ が整数の場合や範囲の指定がある場合に不適切なモデルとなります。
そこで直線以外も扱えるよう一般化したのが「<u>一般化</u>線形モデル」、
という話でした。

この一般化線形モデルを理解するため、
まずは実例のデータに触れて線形モデルを使うことの問題を目で確認します。
そして問題を解決するために「リンク関数」という概念を抑え、
最後に `glm` 関数を実際に使ってみて一般化線形モデルを扱います。

## 直線の当てはめで起きそうな問題

前回使った `sleepstudy` という `data.frame`に
`Correct` という列を追加しました。
これは寝不足の日にちに対する質問への回答が
正解だったか不正解だったかを示しています。
`head()`で観察しましょう。

<div data-datacamp-exercise data-lang="r">
  <code data-type="pre-exercise-code">
    library(lattice)  # for xyplot
    library(lme4)  # for sleapstudy data
    # make data
    rt = sleepstudy$Reaction
    rt_p= 1-(rt-min(rt))/(max(rt)-min(rt))
    sleepstudy$Correct = rbinom(p=rt_p, n=1, size=1)
  </code>
  <code data-type="sample-code">
    # 
  </code>
  <code data-type="solution">
    head(sleepstudy)
  </code>
  <code data-type="sct">
    test_function("head")
    success_msg("Great job!")
  </code>
  <div data-type="hint">
  </div>
</div>

`sleepstudy` の `Correct` には
日にちごとの正答率を求める？
aggregate(Correct~Days, sleepstudy, mean)

次は `xyplot` を使って `Days` に対する `Correct` の減少を図示してみましょう。
なお今回は `type=c("p", "r")` というオプションをつけて
散布図と回帰の直線も描画させます。

aggregate.
デフォルトで入っているから便利
でも分析できない。

<div data-datacamp-exercise data-lang="r">
  <code data-type="pre-exercise-code">
    library(lattice); library(lme4)
    rt = log(sleepstudy$Reaction) # 偏りをなくす
    rt_p = 1-(rt-min(rt))/(max(rt)-min(rt)) # scale(minmax)
    sleepstudy$Correct = as.integer(rbinom(p=rt_p, n=length(rt_p), size=1))
  </code>
  <code data-type="sample-code">
    xyplot(, , type=c("p", "r"))
  </code>
  <code data-type="solution">
    f = Correct ~ Days
    xyplot(f, sleepstudy, type=c("p", "r"))
  </code>
  <code data-type="sct">
    test_function("xyplot")
    success_msg("Great job!")
  </code>
  <div data-type="hint">
  </div>
</div>

## リンク関数

y=ax+b ではなく y=f(ax+b) を考える。
yには0や1,
ax+bには200など。
これを0--1の値に収める関数;
一旦収めると y=1の時に 0.2だったら変.
y=0の時に 0.8 だったら変。
そういう感じで aやbの値を更新できる。


カーブして欲しい。
これは0--1の連続


ここまでをまとめると







[u1]: ./1.html
[u2]: ./2.html
[u3]: ./3.html
