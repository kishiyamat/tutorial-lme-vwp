---
layout: post
title: 一般化線形モデル
description: LMEの解説ページ
    <a href="./">  🏠  <a>
---

[前回][u1] はチュートリアルのモチベーションとゴール、
そして線形モデルをつくりました。
またRでモデルを作るには3つの要素が必要だとも述べました。
今回は前回で述べたゴール、
「直線以外の関係 に一般化させる」
について取り組んでいきます。
もう一度モチベーションを振り返りましょう。

まず前回の $y = ax_1 + b$ は `lm` でモデルを作成できますが、
これは $y$ が要因に対して直線の関係にあることや負の値を取れることを仮定してました。
なので $y$ が整数の場合や範囲の指定がある場合に不適切なモデルとなります。
そこで直線以外も扱えるよう一般化したのが「<u>一般化</u>線形モデル」、
という話でした。

この一般化線形モデルを理解するため、
まずは実例のデータに触れながら <u>(i) 線形モデルを使うことの問題 </u> を確認します。
そして <u>(ii) 問題を解決するための「リンク関数」という概念 </u> を抑え、
最後に <u>(iii) glm を用いた一般化線形モデル </u> を実際に作成してみます。

## 直線の当てはめで起きそうな問題

前回使った `sleepstudy` という `data.frame`に
`Correct` という列を追加しました。
これは寝不足の日にちに対し、回答の正解(1)/不正解(0)を示しています。
このような0/1のデータに対する直線のモデルの妥当性を見るために `xyplot()` を使いましょう。
今回は `Correct` を `Days` で説明しましょう。さらに今回は `type=c("p", "r"))` というオプションを引いて、
プロット(p)だけでなく回帰(r)の直線も描画しましょう。

一人の被験者に限定して描画

<div data-datacamp-exercise data-lang="r">
  <code data-type="pre-exercise-code">
    library(lattice); library(lme4)
    # data
    rt = sleepstudy$Reaction
    sigmoid = function(x) {1 / (1 + exp(-x))}
    scale = function(x) (x-min(x))/(max(x)-min(x))
    ps = sigmoid(-5*scale(rt)+2)
    xs = as.integer(rbinom(ps, n=length(ps), size=1))
    sleepstudy$Correct = xs
    sleepstudy_350 = subset(sleepstudy, Subject==350)
  </code>
  <code data-type="sample-code">
    # f = Reaction ~ Days # 前回の範囲
    f = 
    xyplot(f, sleepstudy_350, type=c("p", "r"))
  </code>
  <code data-type="solution">
    f = Correct ~ Days
    xyplot(f, sleepstudy_350, type=c("p", "r"))
  </code>
  <code data-type="sct">
    test_function("xyplot")
    success_msg("Great job!")
  </code>
  <div data-type="hint">
    前回は Reaction ~ Days を見ましたね。今回は Correct を見ましょう。
  </div>
</div>

当てはめられた傾きが右肩下がりなので、
日にちが増すほど正解が減ることは分かるのですが、
全くfitしてません。何がダメなのでしょうか。
<!--
(前回同様、余裕がある方は `Correct ~ Days | Subject`
と `formula` を変えて被験者ごとにフィッティングをしてみてください。)
->

寝不足の日にちごとの正答率は
`sleepstudy` の `Correct` には
aggregate(Correct~Days, sleepstudy, mean)

次は `xyplot` を使って `Days` に対する `Correct` の減少を図示してみましょう。
なお今回は `type=c("p", "r")` というオプションをつけて
散布図と回帰の直線も描画させます。

aggregate.
デフォルトで入っているから便利
でも分析できない。

<div data-datacamp-exercise data-lang="r">
  <code data-type="pre-exercise-code">
    library(lattice); library(lme4)
    rt = log(sleepstudy$Reaction) # 偏りをなくす
    rt_p = 1-(rt-min(rt))/(max(rt)-min(rt)) # scale(minmax)
    sleepstudy$Correct = as.integer(rbinom(p=rt_p, n=length(rt_p), size=1))
  </code>
  <code data-type="sample-code">
    xyplot(, , type=c("p", "r"))
  </code>
  <code data-type="solution">
    f = Correct ~ Days
    xyplot(f, sleepstudy, type=c("p", "r"))
  </code>
  <code data-type="sct">
    test_function("xyplot")
    success_msg("Great job!")
  </code>
  <div data-type="hint">
  </div>
</div>

## リンク関数

y=ax+b ではなく y=f(ax+b) を考える。
yには0や1,
ax+bには200など。
これを0--1の値に収める関数;
一旦収めると y=1の時に 0.2だったら変.
y=0の時に 0.8 だったら変。
そういう感じで aやbの値を更新できる。


カーブして欲しい。
これは0--1の連続


ここまでをまとめると







[u1]: ./1.html
[u2]: ./2.html
[u3]: ./3.html
